From aad5d98b43c33f789e02073998443522254acbe8 Mon Sep 17 00:00:00 2001
From: Jasper St. Pierre <jstpierre@mecheye.net>
Date: Wed, 20 Feb 2013 02:18:48 +0000
Subject: iconGrid: Take extra spacing into account for height requests

This fixes the clipped app picker in the overview.

https://bugzilla.gnome.org/show_bug.cgi?id=694234
---
diff --git a/js/ui/iconGrid.js b/js/ui/iconGrid.js
index 98e5761..b3755cb 100644
--- a/js/ui/iconGrid.js
+++ b/js/ui/iconGrid.js
@@ -218,11 +218,14 @@ const IconGrid = new Lang.Class({
 
     _getPreferredHeight: function (grid, forWidth, alloc) {
         let children = this._getVisibleChildren();
-        let nColumns;
-        if (forWidth < 0)
+        let nColumns, spacing;
+        if (forWidth < 0) {
             nColumns = children.length;
-        else
-            nColumns = this._computeLayout(forWidth)[0];
+            spacing = this._spacing;
+        } else {
+            [nColumns, , spacing] = this._computeLayout(forWidth);
+        }
+
         let nRows;
         if (nColumns > 0)
             nRows = Math.ceil(children.length / nColumns);
@@ -230,7 +233,7 @@ const IconGrid = new Lang.Class({
             nRows = 0;
         if (this._rowLimit)
             nRows = Math.min(nRows, this._rowLimit);
-        let totalSpacing = Math.max(0, nRows - 1) * this._spacing;
+        let totalSpacing = Math.max(0, nRows - 1) * spacing;
         let height = nRows * this._vItemSize + totalSpacing;
         alloc.min_size = height;
         alloc.natural_size = height;
